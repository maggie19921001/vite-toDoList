import{u as S,r as c,k as x,l as I,o as u,c as d,a as e,t as y,b as C,v as D,n as T,F as M,m as P,h as r,q,i as R,d as j}from"./index-GsOIBGww.js";const G={id:"todoListPage",class:"bg-half"},H=e("h1",null,"ONLINE TODO LIST",-1),J={class:"todo_sm"},K={class:"container todoListPage vhContainer"},Q={class:"todoList_Content"},W={class:"inputBox"},X={class:"todoList_list"},Y={class:"todoList_tab"},Z={class:"todoList_items"},tt={key:0,class:"no-item"},et={key:1,class:"no-item"},ot={key:2,class:"todoList_item"},st={class:"todoList_label"},nt={class:"items"},at=["onUpdate:modelValue","onClick"],it={class:"edit-block"},lt={key:0,class:"btns"},ct=["onUpdate:modelValue","onChange"],ut=["onClick"],dt=e("span",{class:"material-icons"},"done",-1),rt=[dt],ht=["onClick"],vt=e("span",{class:"material-icons"},"edit",-1),_t=[vt],pt=["onClick"],mt=e("span",{class:"material-icons"},"delete",-1),kt=[mt],gt={class:"todoList_statistics"},h="https://todolist-api.hexschool.io",Tt={__name:"ToDoList",setup(ft){const p=S(),n=(()=>{const t=document.cookie.split(";");for(let o of t){const[s,f]=o.trim().split("=");if(s==="loginToken")return f;alert("沒有token，請重新登入"),setTimeout(()=>{p.push("/")},1e3)}return null})(),b=c({nickname:"",uid:""}),$=c(""),w=async()=>{try{const t=await r.get(`${h}/users/checkout`,{headers:{Authorization:n}});b.value=t.data}catch(t){$.value=t.message,console.log("錯誤訊息",$),alert("驗證失敗，請重新登入"),setTimeout(()=>{p.push("/")},1e3)}},z=async()=>{try{const t=await r.post(`${h}/users/sign_out`,{},{headers:{Authorization:n}}),o=new Date;o.setDate(o.getDate()-1),document.cookie=`loginToken=${n}; expires=${o.toUTCString()}`,p.push("/")}catch(t){console.log(t.message)}},a=c([]),L={content:""},v=c(""),l=c({id:""}),m=c(!1),k=async()=>{try{m.value=!0;const t=await r.get(`${h}/todos`,{headers:{Authorization:n}});a.value=t.data.data,setTimeout(()=>{m.value=!1},500)}catch{alert("取得待辦事項時出現錯誤，請重新整理頁面或稍後再試，如問題持續，請聯繫開發者")}},A=async()=>{if(v.value!=null&&v.value!=""){L.content=v.value;try{const t=await r.post(`${h}/todos`,L,{headers:{Authorization:n}});v.value="",a.value.push(t.data.newTodo)}catch{}}else alert("需填入內容")},E=t=>{const o=a.value.find(s=>s.id===t);o&&(o.isEditing=!o.isEditing,l.value[t]=o.content)},V=(t,o)=>{l.value={...l.value,[o]:t.target.value}},U=async t=>{const o=a.value.find(s=>s.id===t);o.content=l.value[t];try{await r.put(`${h}/todos/${t}`,o,{headers:{Authorization:n}})}catch{alert("重複操作，請稍待重試")}o.isEditing=!1,l.value={...l.value,[t]:""}},B=async t=>{if(confirm("確定要刪除嗎？")==!0)try{await r.delete(`${h}/todos/${t}`,{headers:{Authorization:n}}),k()}catch{}},N=async t=>{try{await r.patch(`${h}/todos/${t}/toggle`,{},{headers:{Authorization:n}})}catch{}},_=c("all"),g=t=>{_.value=t},O=x(()=>_.value==="unDone"?a.value.filter(t=>!t.status):_.value==="completed"?a.value.filter(t=>t.status):a.value);I(()=>{n&&(w(),k())});const F=x(()=>a.value.filter(t=>t.status==!1).length);return(t,o)=>(u(),d("div",G,[e("nav",null,[H,e("ul",null,[e("li",J,[e("a",{onClick:k},[e("span",null,y(b.value.nickname)+"的代辦",1)])]),e("li",null,[e("a",{href:"#",onClick:z},"登出")])])]),e("div",K,[e("div",Q,[e("div",W,[C(e("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":o[0]||(o[0]=s=>v.value=s)},null,512),[[D,v.value]]),e("button",{onClick:A,class:"fa fa-plus"},"＋")]),e("div",X,[e("ul",Y,[e("li",null,[e("a",{onClick:o[1]||(o[1]=s=>g("all")),class:T({active:_.value=="all"})},"全部",2)]),e("li",null,[e("a",{onClick:o[2]||(o[2]=s=>g("unDone")),class:T({active:_.value=="unDone"})},"未完成",2)]),e("li",null,[e("a",{onClick:o[3]||(o[3]=s=>g("completed")),class:T({active:_.value=="completed"})},"已完成",2)])]),e("div",Z,[a.value.length===0?(u(),d("div",tt,"目前尚無待辦事項")):m.value==!0?(u(),d("div",et,"Loading...")):(u(),d("ul",ot,[(u(!0),d(M,null,P(O.value,(s,f)=>(u(),d("li",{key:f},[e("label",st,[e("div",nt,[C(e("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":i=>s.status=i,onClick:i=>N(s.id)},null,8,at),[[q,s.status]]),R(" "+y(s.content),1)]),e("div",it,[s.isEditing?(u(),d("div",lt,[C(e("input",{type:"text","onUpdate:modelValue":i=>l.value[s.id]=i,onChange:i=>V(i,s.id)},null,40,ct),[[D,l.value[s.id]]]),e("button",{type:"button",class:"edit-btn",onClick:i=>U(s.id)},rt,8,ut)])):j("",!0),e("button",{type:"button",class:"edit-btn",onClick:i=>E(s.id)},_t,8,ht),e("button",{type:"button",class:"edit-btn",onClick:i=>B(s.id)},kt,8,pt)])])]))),128))])),e("div",gt,[e("p",null,y(F.value)+" 個待完成項目",1)])])])])])]))}};export{Tt as default};
