import{u as I,r as u,k as M,l as P,o as a,c as l,a as t,t as b,b as _,v as C,n as D,F as q,m as R,h as r,q as E,i as w,d as m}from"./index-8cJi8fwC.js";const j={id:"todoListPage",class:"bg-half"},G=t("h1",null,"ONLINE TODO LIST",-1),H={class:"todo_sm"},J={class:"container todoListPage vhContainer"},K={class:"todoList_Content"},Q={class:"inputBox"},W={class:"todoList_list"},X={class:"todoList_tab"},Y={class:"todoList_items"},Z={key:0,class:"no-item"},tt={key:1,class:"no-item"},et={key:2,class:"todoList_item"},st={key:0,class:"todoList_label"},ot={class:"items"},nt=["onUpdate:modelValue","onClick"],it={class:"edit-block"},at={key:0,class:"btns"},lt=["onUpdate:modelValue","onChange"],ct=["onClick"],dt=t("span",{class:"material-icons"},"done",-1),ut=[dt],_t=["onClick"],rt=t("span",{class:"material-icons"},"edit",-1),ht=[rt],vt=["onClick"],pt=t("span",{class:"material-icons"},"delete",-1),kt=[pt],mt={key:1,class:"todoList_label"},bt={class:"items"},Ct=["onUpdate:modelValue","onClick"],gt={class:"edit-block"},yt={key:0,class:"btns"},$t=["onUpdate:modelValue","onChange"],ft=["onClick"],Tt=t("span",{class:"material-icons"},"done",-1),Lt=[Tt],xt=["onClick"],Vt=t("span",{class:"material-icons"},"edit",-1),Ut=[Vt],Dt=["onClick"],Et=t("span",{class:"material-icons"},"delete",-1),wt=[Et],zt={key:2,class:"todoList_label"},At={class:"items"},Bt=["onUpdate:modelValue","onClick"],Nt={class:"edit-block"},Ot={key:0,class:"btns"},Ft=["onUpdate:modelValue","onChange"],St=["onClick"],It=t("span",{class:"material-icons"},"done",-1),Mt=[It],Pt=["onClick"],qt=t("span",{class:"material-icons"},"edit",-1),Rt=[qt],jt=["onClick"],Gt=t("span",{class:"material-icons"},"delete",-1),Ht=[Gt],Jt={class:"todoList_statistics"},h="https://todolist-api.hexschool.io",Xt={__name:"ToDoList",setup(Kt){const g=I(),c=(()=>{const s=document.cookie.split(";");for(let n of s){const[e,U]=n.trim().split("=");if(e==="loginToken")return U;alert("沒有token，請重新登入"),setTimeout(()=>{g.push("/")},1e3)}return null})(),z=u({nickname:"",uid:""}),A=u(""),N=async()=>{try{const s=await r.get(`${h}/users/checkout`,{headers:{Authorization:c}});z.value=s.data}catch(s){A.value=s.message,console.log("錯誤訊息",A),alert("驗證失敗，請重新登入"),setTimeout(()=>{g.push("/")},1e3)}},O=async()=>{try{const s=await r.post(`${h}/users/sign_out`,{},{headers:{Authorization:c}}),n=new Date;n.setDate(n.getDate()-1),document.cookie=`loginToken=${c}; expires=${n.toUTCString()}`,g.push("/")}catch(s){console.log(s.message)}},v=u([]),B={content:""},p=u(""),i=u(""),y=u(!1),k=async()=>{try{y.value=!0;const s=await r.get(`${h}/todos`,{headers:{Authorization:c}});v.value=s.data.data,setTimeout(()=>{y.value=!1},500)}catch{}},F=async()=>{if(p.value!=null&&p.value!=""){B.content=p.value;try{await r.post(`${h}/todos`,B,{headers:{Authorization:c}}),p.value="",k()}catch{}}else alert("需填入內容")},$=(s,n)=>{i.value={...i.value,[n]:s.target.value}},f=s=>{const n=v.value.find(e=>e.id===s);n&&(n.isEditing=!n.isEditing,i.value[s]=n.content)},T=async s=>{const n=v.value.find(e=>e.id===s);n.content=i.value[s];try{await r.put(`${h}/todos/${s}`,n,{headers:{Authorization:c}})}catch{}n.isEditing=!1,k(),i.value={...i.value,[s]:""}},L=async s=>{if(confirm("確定要刪除嗎？")==!0)try{await r.delete(`${h}/todos/${s}`,{headers:{Authorization:c}}),k()}catch{}},x=async s=>{try{await r.patch(`${h}/todos/${s}/toggle`,{},{headers:{Authorization:c}}),k()}catch{}},d=u("all"),V=s=>{d.value=s};M(()=>{c&&(N(),k())});const S=P(()=>v.value.filter(s=>s.status==!1).length);return(s,n)=>(a(),l("div",j,[t("nav",null,[G,t("ul",null,[t("li",H,[t("a",{onClick:k},[t("span",null,b(z.value.nickname)+"的代辦",1)])]),t("li",null,[t("a",{href:"#",onClick:O},"登出")])])]),t("div",J,[t("div",K,[t("div",Q,[_(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":n[0]||(n[0]=e=>p.value=e)},null,512),[[C,p.value]]),t("button",{onClick:F,class:"fa fa-plus"},"＋")]),t("div",W,[t("ul",X,[t("li",null,[t("a",{onClick:n[1]||(n[1]=e=>V("all")),class:D({active:d.value=="all"})},"全部",2)]),t("li",null,[t("a",{onClick:n[2]||(n[2]=e=>V("unDone")),class:D({active:d.value=="unDone"})},"未完成",2)]),t("li",null,[t("a",{onClick:n[3]||(n[3]=e=>V("completed")),class:D({active:d.value=="completed"})},"已完成",2)])]),t("div",Y,[v.value.length===0?(a(),l("div",Z,"目前尚無待辦事項")):y.value==!0?(a(),l("div",tt,"Loading...")):(a(),l("ul",et,[(a(!0),l(q,null,R(v.value,(e,U)=>(a(),l("li",{key:U},[d.value=="all"?(a(),l("label",st,[t("div",ot,[_(t("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":o=>e.status=o,onClick:o=>x(e.id)},null,8,nt),[[E,e.status]]),w(" "+b(e.content),1)]),t("div",it,[e.isEditing?(a(),l("div",at,[_(t("input",{type:"text","onUpdate:modelValue":o=>i.value[e.id]=o,onChange:o=>$(o,e.id)},null,40,lt),[[C,i.value[e.id]]]),t("button",{type:"button",class:"edit-btn",onClick:o=>T(e.id)},ut,8,ct)])):m("",!0),t("button",{type:"button",class:"edit-btn",onClick:o=>f(e.id)},ht,8,_t),t("button",{type:"button",class:"edit-btn",onClick:o=>L(e.id)},kt,8,vt)])])):m("",!0),d.value=="unDone"&&e.status===!1?(a(),l("label",mt,[t("div",bt,[_(t("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":o=>e.status=o,onClick:o=>x(e.id)},null,8,Ct),[[E,e.status]]),w(" "+b(e.content),1)]),t("div",gt,[e.isEditing?(a(),l("div",yt,[_(t("input",{type:"text","onUpdate:modelValue":o=>i.value[e.id]=o,onChange:o=>$(o,e.id)},null,40,$t),[[C,i.value[e.id]]]),t("button",{type:"button",class:"edit-btn",onClick:o=>T(e.id)},Lt,8,ft)])):m("",!0),t("button",{type:"button",class:"edit-btn",onClick:o=>f(e.id)},Ut,8,xt),t("button",{type:"button",class:"edit-btn",onClick:o=>L(e.id)},wt,8,Dt)])])):m("",!0),d.value=="completed"&&e.status===!0?(a(),l("label",zt,[t("div",At,[_(t("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":o=>e.status=o,onClick:o=>x(e.id)},null,8,Bt),[[E,e.status]]),w(" "+b(e.content),1)]),t("div",Nt,[e.isEditing?(a(),l("div",Ot,[_(t("input",{type:"text","onUpdate:modelValue":o=>i.value[e.id]=o,onChange:o=>$(o,e.id)},null,40,Ft),[[C,i.value[e.id]]]),t("button",{type:"button",class:"edit-btn",onClick:o=>T(e.id)},Mt,8,St)])):m("",!0),t("button",{type:"button",class:"edit-btn",onClick:o=>f(e.id)},Rt,8,Pt),t("button",{type:"button",class:"edit-btn",onClick:o=>L(e.id)},Ht,8,jt)])])):m("",!0)]))),128))])),t("div",Jt,[t("p",null,b(S.value)+" 個待完成項目",1)])])])])])]))}};export{Xt as default};
